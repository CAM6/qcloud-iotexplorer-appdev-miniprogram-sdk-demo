<template name="property-item">
  <view class="panel-item need-hover {{item.define.type !== 'bool' ? 'append-arrow' : ''}} {{disabled ? 'disabled' : ''}}" bindtap="onTapItem" data-item="{{item}}" hover-start-time="20" hover-stay-time="70" hover-class="hover">
    <view class="item-name">{{item.name}}</view>
    <view class="expander" />
    <view class="item-value">
      <block wx:if="{{item.define.type === 'bool'}}">
        <view class="switch-cover" />
        <switch checked="{{rawValue}}" />
      </block>
      <block wx:elif="{{item.define.type === 'enum'}}">
        <view>{{item.define.mapping[rawValue] ? item.define.mapping[rawValue] : '-'}}</view>
      </block>
      <block wx:else>{{item.value}}{{item.define.unit ? item.define.unit : ''}}</block>
    </view>
  </view>
</template>

<van-popup show="{{ timeThemePopupShow }}" position="bottom" bind:close="closeTimeThemePopup">
  <van-picker
    default-index="{{timeThemeIndex}}"
    columns="{{timeThemeList}}"
    show-toolbar
    bind:cancel="closeTimeThemePopup"
    bind:confirm="onConfirmTimeThemePicker"
  />
</van-popup>

<page-wrapper>
  <view class="container">
    <view class="more-row">
      <view
        class="more-btn need-hover"
        hoverStartTime="20"
        hoverStayTime="70"
        hoverClass="hover"
        data-item="{{item}}"
        bindtap="onClickMoreBtn"
      >
        <image class="more-btn-icon" src="/assets/common/more.svg" />
      </view>
    </view>
  
    <view class="page-title">
      {{deviceInfo.AliasName || '设备控制'}}
      <view class="item-status status-online" wx:if="{{deviceInfo.DeviceName === '~virtualDev'}}">虚拟设备</view>
      <view class="item-status status-online" wx:elif="{{deviceInfo.NetType === 'ble'}}">蓝牙设备</view>
      <view class="item-status status-online" wx:elif="{{deviceInfo.NetType === 'lorawan'}}">LoRa 设备</view>
      <view class="item-status status-online" wx:elif="{{deviceInfo.NetType === 'wifi-ble'}}">wifi设备</view>
      <view class="item-status status-{{deviceStatus === 1 ? 'online' : 'offline'}}" wx:else>{{deviceStatus === 1 ? '在线' : '离线'}}</view>
    </view>
    <view class="page-main">
      <view class="switch_card">
        <van-cell title="休眠:" title-class="cell-title-class" custom-class="custom-class"> 
          <van-switch checked="{{ switchValue }}" active-color="#0019ff" bind:change="onSwitchChange" size="20px" custom-class="custom-class"/>
        </van-cell>
      </view>
      <view class="card">
        <text class="radio-text">显示模式:</text>
        <view class="custom-radio-group">
        <van-radio-group value="{{ modeValue }}" bind:change="onRadioChange" direction="horizontal">
          <van-radio name="1" custom-class="custom-radio" checked-color="#0019ff">时间</van-radio>
          <van-radio name="2" custom-class="custom-radio" checked-color="#0019ff">日期</van-radio>
          <van-radio name="3" custom-class="custom-radio" checked-color="#0019ff">专业</van-radio>
          <van-radio name="4" custom-class="custom-radio" checked-color="#0019ff">照片</van-radio>
        </van-radio-group>
      </view>

      <view class="slider-row">
        <view class="slider-text">屏幕背光:</view>    
          <van-slider value="{{brightnessValue}}" bar-height="4px" active-color="#001aff" use-button-slot bind:drag-end="onBrightnessEnd" bind:drag="onBrightnessChange" custom-class="custom-slider">
            <view class="custom-button" slot="button" style="background-color: #001aff;">{{brightnessValue}}</view>
          </van-slider>
      </view>

      <van-cell title="时间主题:" is-link value="{{timeThemeValue}}" title-class="cell-title-class" custom-class="time-theme" border="{{ false }}" id= "0" bind:click="showTimeThemePopup"	></van-cell>
      
    </view>

      <van-cell 
      is-link
      title="RGB控制"
      link-type="navigateTo"
      url="/pages/device-panel/nixie-tube-ips-panel/rgb-control/rgb-control"
      />
      <van-cell 
      is-link
      title="相册管理"
      link-type="navigateTo"
      url="/pages/device-panel/nixie-tube-ips-panel/photo-send/photo-send"
      />
      <van-cell 
      is-link
      title="下载主题"
      link-type="navigateTo"
      url="/pages/device-panel/nixie-tube-ips-panel/select-theme/select-theme"
      />
      <van-cell 
      is-link
      title="更多设置"
      link-type="navigateTo"
      url="/pages/device-panel/nixie-tube-ips-panel/more-setting/more-setting"
      />

      <view class="panel-list">
        <block wx:if="{{dataTemplate.properties.length > 0}}">
          <block wx:for="{{dataTemplate.properties}}" wx:key="id">
            <picker wx:if="{{item.define.type === 'enum'}}"
              bindchange="onPickerChange" 
              value="{{item.value}}"
              range="{{item.mappingList}}"
              range-key="label"
              data-item="{{item}}"
              disabled="{{item.mode !== 'rw' || deviceStatus === 0}}"
            >
              <template
                is="property-item"
                data="{{item, rawValue: deviceData[item.id], disabled: (item.mode !== 'rw' || deviceStatus === 0)}}"
              />
            </picker>
            <template wx:else
              is="property-item"
              data="{{item, rawValue: deviceData[item.id], disabled: (item.mode !== 'rw' || deviceStatus === 0)}}"
            />
          </block>
        </block>
      </view>
    </view>
  </view>
</page-wrapper>
<view class="modal" wx:if="{{numberDialog.visible && numberDialog.panelConfig}}">
  <view class="modal-mask" bindtap="onHideNumberDialog" />
  <view class="modal-dialog {{ ipx ? 'ipx' : '' }}">
    <view class="modal-dialog-title">{{numberDialog.panelConfig.name}}设置</view>
    <slider max="{{numberDialog.panelConfig.define.max}}" min="{{numberDialog.panelConfig.define.min}}" step="{{numberDialog.panelConfig.define.step}}" value="{{numberDialog.panelConfig.value}}" show-value bindchange="onNumberDialogChange" />
    <button bindtap="onNumberDialogSubmit" class="modal-dialog-submit-btn">确定</button>
  </view>
</view>